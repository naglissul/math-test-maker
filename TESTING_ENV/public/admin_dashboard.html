<!DOCTYPE html>
<html>
  <head>
    <title>Stereometrijos kontrolinis</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        padding: 20px;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      h1 {
        color: #333;
        font-size: 24px;
      }

      table {
        width: 90%;
        max-width: 800px;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      table,
      th,
      td {
        border: 1px solid #ccc;
      }

      th,
      td {
        padding: 8px;
        text-align: left;
        font-size: 16px;
      }

      th {
        background-color: #f8f8f8;
      }

      caption {
        font-size: 18px;
        font-weight: bold;
        padding: 10px;
        caption-side: top;
        text-align: left;
      }

      button {
        padding: 10px 20px;
        font-size: 16px;
        color: white;
        background-color: #007bff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-bottom: 20px;
      }

      button:hover {
        background-color: #0056b3;
      }
    </style>
    <script type="module">
      // Import necessary Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

      import {
        getDatabase,
        ref,
        onValue,
        get,
        set,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDE6Yx4cXghxsn6FKOVEXYN8aavEzOipWA",
        authDomain: "kontrass.firebaseapp.com",
        databaseURL:
          "https://kontrass-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "kontrass",
        storageBucket: "kontrass.appspot.com",
        messagingSenderId: "691360022307",
        appId: "1:691360022307:web:b8d0cae3fd88b38e275696",
      };
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth(app);
      document.addEventListener("DOMContentLoaded", (event) => {
        const checkButton = document.getElementById("gradeResponses2");
        checkButton.addEventListener("click", grade2);
      });

      function grade2() {
        const responsesFinal = {};
        const answersKey = [
          {
            number: "1.",
            correctAnswers: ["(-2;3)"],
          },
          {
            number: "2.",
            correctAnswers: [
              "[-2;+begalybė)",
              "[-2;+∞]",
              "[-2;begalybė)",
              "[-2;begalybe)",
              "[-2;+begalybe)",
            ],
          },
          {
            number: "3.",
            correctAnswers: [
              "(-begalybe; -2),(-1;1)",
              "(-begalybė; -2),(-1;1)",
            ],
          },
          {
            number: "4.",
            correctAnswers: ["Ne", "ne", "Nepriklauso", "nepriklauso"],
          },
          {
            number: "5.",
            correctAnswers: ["(-2;0),(2;0)", "(2;0),(-2;0)"],
          },
          {
            number: "6.",
            correctAnswers: ["3"],
          },
          {
            number: "7.",
            correctAnswers: ["3"],
          },
          {
            number: "8.",
            correctAnswers: ["-2"],
          },
          {
            number: "9.",
            correctAnswers: ["-1"],
          },
          {
            number: "10.",
            correctAnswers: ["2"],
          },
          {
            number: "11.",
            correctAnswers: ["A"],
          },
          {
            number: "12.",
            correctAnswers: ["-2"],
          },
          {
            number: "13.",
            correctAnswers: ["(3;2)"],
          },
          {
            number: "14.",
            correctAnswers: ["2;-5", "-5;2"],
          },
        ];
        let results = [];
        // [
        //   {
        //     grade: 0,
        //     id: "1",
        //     outOf: 0,
        //     points: 0,
        //     responses: [
        //       {
        //         answer: "Atsakymas1",
        //         correct: true,
        //         correctAnswer: "Atsakymas1",
        //         question: "1.",
        //       },
        //       {
        //         answer: "Atsakymas2",
        //         correct: false,
        //         correctAnswer: "Atsakymas3",
        //         question: "2.",
        //       },
        //     ],
        //   },
        // ];

        //algo
        Object.keys(responsesFinal).forEach((responseId) => {
          const response = responsesFinal[responseId];
          let gradedResults = {
            id: response.id,
            responses: [],
            points: 0,
            outOf: answerKey.length,
            grade: 0,
          };

          response.answers.forEach((answer, index) => {
            const questionNumber = index + 1;
            const questionKey = answerKey.find(
              (q) => q.number === questionNumber + "."
            );
            const isCorrect = questionKey
              ? questionKey.correctAnswers.includes(answer.replace(/\s/g, ""))
              : false;
            gradedResults.responses.push({
              question: questionNumber + ".",
              answer: answer,
              correct: isCorrect,
              correctAnswer: questionKey
                ? questionKey.correctAnswers.join(" or ")
                : "No answer provided",
            });
            if (isCorrect) {
              gradedResults.points++;
            }
          });

          gradedResults.grade =
            (gradedResults.points * 8) / gradedResults.outOf + 2;
          results.push(gradedResults);
        });

        //push
        const resultsRef = ref(database, "results2");
        set(resultsRef, results);
        alert("graded");
      }

      document.addEventListener("DOMContentLoaded", (event) => {
        const checkButton = document.getElementById("gradeResponses");
        checkButton.addEventListener("click", grade);
      });

      function grade() {
        const responsesFinal = {
          "-NxBYT9ct9M07MGWbhNt": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "5",
              "A",
              "D",
              "x(1+3x)",
              "(x+1)²",
              "(x-3)(x+3)",
              "(x-1)(x+3)",
              "1;-3",
              "(-∞; -1)",
              "B",
            ],
            id: "AKCP-10a15",
            timestamp: "2024-05-06T06:18:38.115Z",
          },
          "-NxBY_r8xU7qUhrcfGdv": {
            answers: [
              "0.4",
              "B",
              "-1/3",
              "3",
              "BCA",
              "30",
              "A",
              "C",
              "x(1+3x)",
              "(x+1)²",
              "(x-3) ²",
              "(x-2)²",
              "",
              "(-∞;-1)",
              "C",
            ],
            id: "AKCP-10a20",
            timestamp: "2024-05-06T06:19:09.631Z",
          },
          "-NxBYdFkxcEX8d_FO_zm": {
            answers: [
              "11/15",
              "B",
              "",
              "3/1",
              "BCA",
              "5",
              "A",
              "D",
              "x+3*x*x",
              "x*x+2*x+1",
              "x*x-9",
              "x*x+2*x-3",
              "",
              "",
              "C",
            ],
            id: "AKCP-10a12",
            timestamp: "2024-05-06T06:19:23.526Z",
          },
          "-NxBYvDw-yH2qiYc_ut3": {
            answers: [
              "0,7",
              "B",
              "-1/3",
              "3",
              "BCA",
              "30",
              "A",
              "D",
              "x(1+3x)",
              "(x+1)²",
              "(x+3)(x-3)",
              "x(x+2)-3",
              "1;-3",
              "(-∞;-1)",
              "B",
            ],
            id: "AKCP-10a24",
            timestamp: "2024-05-06T06:20:37.173Z",
          },
          "-NxBZeDNmxnutdcJmjFX": {
            answers: [
              "44/60",
              "B",
              "-1/3",
              "3/1",
              "CBA",
              "30",
              "A",
              "C",
              "X(1+3x)",
              "x(1+2x)+1",
              "x⋅x-9",
              "",
              "1",
              "",
              "B",
            ],
            id: "AKCP-10a23",
            timestamp: "2024-05-06T06:23:49.646Z",
          },
          "-NxBZgWcXtsid6p2xs--": {
            answers: [
              "11/ 15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "30",
              "A",
              "C",
              "x+(3x⋅3x)",
              "(x⋅x+2x)+1",
              "(X-3)(x+3)",
              "(x⋅x+2x)-3",
              "1;3",
              "(-∞ ;4]",
              "B",
            ],
            id: "AKCP-10a5",
            timestamp: "2024-05-06T06:23:59.075Z",
          },
          "-NxBZxnzLpALen8GRi1I": {
            answers: [
              "2/5",
              "B",
              "-1/3",
              "1",
              "BCA",
              "30",
              "A",
              "C",
              "",
              "1²⋅2⋅1⋅1⋅1²",
              "(x-3)(x+3)",
              "1²⋅2⋅1⋅1⋅3²",
              "2;3",
              "(-∞;-1]",
              "B",
            ],
            id: "AKCP-10a18",
            timestamp: "2024-05-06T06:25:09.873Z",
          },
          "-NxB_-CjKDzCvTlrOU58": {
            answers: [
              "26/36",
              "B",
              "-1/3",
              "3",
              "ACB",
              "30",
              "A",
              "D",
              "x+x(3+x)",
              "(x+1)(x+1)",
              "(x-3)(x+3)",
              "x(x+2)-3",
              "1;3",
              "[-2;-∞]",
              "C",
            ],
            id: "AKCP-10a4",
            timestamp: "2024-05-06T06:25:19.722Z",
          },
          "-NxB_2k3tdfyK7l3L2V5": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "30",
              "A",
              "D",
              "x(1+3x)",
              "(x+1)²",
              "(x+3)(x-3)",
              "-(-x²-2x+3)",
              "1;-3",
              "(-∞;-1)",
              "B",
            ],
            id: "AKCP-10a3",
            timestamp: "2024-05-06T06:25:34.207Z",
          },
          "-NxB_AGwBsAFo3Q9zwg4": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "30",
              "A",
              "D",
              "x(1+3x)",
              "(x+1)²",
              "(x+√9)(x-√9)",
              "a(x-x1)(x-x2) arba diskriminantas; D=2²-4*1*(-3)",
              "1; -3",
              "(-∞;-1)",
              "B",
            ],
            id: "AKCP-10a10",
            timestamp: "2024-05-06T06:26:05.051Z",
          },
          "-NxB_CmtchD7hiqODicJ": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "30",
              "A",
              "D",
              "x(1+3x)",
              "(x+1)²",
              "(x-3)(x+3)",
              "(x-1)(x+3)",
              "1;-3",
              "(-∞;-1)",
              "B",
            ],
            id: "AKCP-10a7",
            timestamp: "2024-05-06T06:26:15.348Z",
          },
          "-NxB_EFCbmfJS_ijzTKr": {
            answers: [
              "11/15 0.73",
              "B",
              "-1/3",
              "2/3",
              "BCA",
              "5",
              "A",
              "C",
              "x⋅(1+3x)",
              "(x+1)²",
              "(x-3)⋅(x+3)",
              "69",
              "69",
              "69",
              "D",
            ],
            id: "AKCP-10a11",
            timestamp: "2024-05-06T06:26:21.319Z",
          },
          "-NxB_KJ55Q9CSF1498D9": {
            answers: [
              "0,73",
              "B",
              "3/1",
              "3/1",
              "CBA",
              "5",
              "5",
              "D",
              "0",
              "1",
              "-9",
              "-3",
              "0;-1",
              "(4;2)",
              "B",
            ],
            id: "AKCP-10a22",
            timestamp: "2024-05-06T06:26:46.149Z",
          },
          "-NxB_MyZPIAItElN3UUn": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "30",
              "A",
              "C",
              "x(1+3x)",
              "(x+1)(x+1)",
              "(x-3)(x+3)",
              "(x-1)(x+3)",
              "1;-3",
              "(-∞;-1)",
              "B",
            ],
            id: "AKCP-10a19",
            timestamp: "2024-05-06T06:26:57.050Z",
          },
          "-NxB_TS19rzX_cUL7ASW": {
            answers: [
              "11/15",
              "B",
              "-1/ 3",
              "3",
              "BCA",
              "10800",
              "A",
              "D",
              "x(1+3x)",
              "x(x+2+1)",
              "(x-3)(x+3)",
              "1(+2-3)",
              "-3;-2)",
              "",
              "B",
            ],
            id: "AKCP-10a30",
            timestamp: "2024-05-06T06:27:23.580Z",
          },
          "-NxB_VUgph-tUzvcMxNO": {
            answers: [
              "0,39",
              "B",
              "-1/3",
              "3/1",
              "BCA",
              "30",
              "A",
              "C",
              "x(1+3x)",
              "x(x+2)+1",
              "(x-3)(x+3)",
              "x(x+2)-3",
              "-3;1",
              "(-3;1)",
              "B",
            ],
            id: "AKCP-10a13",
            timestamp: "2024-05-06T06:27:31.943Z",
          },
          "-NxB_WJWQ_ngMsNCg2Em": {
            answers: [
              "0,39",
              "B",
              "-1/3",
              "3/1",
              "BCA",
              "",
              "A",
              "B",
              "x(3x+x)",
              "x(x+2)(x+1)",
              "x(x-3)",
              "x(x+2)(x-3)",
              "D=2²+4⋅3=√16=4:",
              "",
              "D",
            ],
            id: "AKCP-10a21",
            timestamp: "2024-05-06T06:27:35.324Z",
          },
          "-NxB_XFRCS2wXn8dcTi1": {
            answers: [
              "0,4",
              "B",
              "-1/3",
              "3",
              "BAC",
              "30",
              "A",
              "D",
              "X(1+3x)",
              "(x+1)²",
              "(x+3)(x-3)",
              "(x-2)(x+3)",
              "2;-3",
              "",
              "B",
            ],
            id: "AKCP-10a16",
            timestamp: "2024-05-06T06:27:39.157Z",
          },
          "-NxB__jHCSp13X0pOvgt": {
            answers: [
              "83/30",
              "B",
              "-1/3",
              "3/1",
              "BCA",
              "5",
              "A",
              "C",
              "x(x+3)",
              "x(x+2x+1)",
              "x(x-9)",
              "x(x+2x-3)",
              "-3;1",
              "(-1;+∞)",
              "C",
            ],
            id: "AKCP-10a14",
            timestamp: "2024-05-06T06:27:53.422Z",
          },
          "-NxB_c50s46LxZy7TyrX": {
            answers: [
              "1",
              "B",
              "-1/3",
              "3",
              "CAB",
              "0",
              "A",
              "D",
              "x(3+x)(3-x)",
              "",
              "(x-9)(x+9)",
              "",
              "-1;1",
              "[4; -∞)[2; +∞)",
              "B",
            ],
            id: "AKCP-10a9",
            timestamp: "2024-05-06T06:28:03.068Z",
          },
          "-NxB_cjMO8foYXXN-8pb": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "ACB",
              "5",
              "A",
              "D",
              "x(1+3x)",
              "x²(0+1)(0",
              "(x+3)(x-3)",
              "",
              "1;-3",
              "(-∞;-1)",
              "D",
            ],
            id: "AKCP-10a29",
            timestamp: "2024-05-06T06:28:05.714Z",
          },
          "-NxB_dwAgliOC7DUduBA": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "",
              "A",
              "D",
              "-1/3",
              "(x+1)²",
              "(x-3)(x+3)",
              "x=1",
              "-3;1",
              "x∈(-∞;-2)",
              "C",
            ],
            id: "AKCP-10a8",
            timestamp: "2024-05-06T06:28:09.770Z",
          },
          "-NxB_eZHXV-vHYYlGWT-": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3/1",
              "BCA",
              "30",
              "A",
              "A",
              "x(1+3x)",
              "x(x+2+1)",
              "1(x²-9)",
              "",
              "",
              "",
              "D",
            ],
            id: "AKCP-10a25",
            timestamp: "2024-05-06T06:28:13.196Z",
          },
          "-NxB_etIndJ5zj3JPx6p": {
            answers: [
              "0.73",
              "B",
              "-(1/3)",
              "3/1",
              "BCA",
              "5",
              "A",
              "D",
              "x(1+3x)",
              "x(x+2+1)",
              "(x-3) (x+3)",
              "x(x+2x",
              "1; -3",
              "[-1; +∞)",
              "A",
            ],
            id: "AKCP-10a26",
            timestamp: "2024-05-06T06:28:14.542Z",
          },
          "-NxB_flFKYzpzdPL4fVx": {
            answers: [
              "0.4",
              "B",
              "-1/3",
              "3",
              "BAC",
              "30",
              "A: 31245",
              "D",
              "x(1+3x)",
              "",
              "(x+3)(x-3)",
              "x(x-2)(+3)",
              "1;-3",
              "",
              "B",
            ],
            id: "AKCP-10a28",
            timestamp: "2024-05-06T06:28:18.121Z",
          },
          "-NxB_g1lAcXprn1eOyut": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3/1",
              "BCA",
              "5",
              "A",
              "D",
              "x(1+3x)",
              "",
              "(x+3)(x-3)",
              "",
              "1;-3",
              "[-1;+∞)",
              "D",
            ],
            id: "AKCP-10a1",
            timestamp: "2024-05-06T06:28:22.533Z",
          },
          "-NxB_hxwLbZpwXEUPOcE": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3/1",
              "ACB",
              "30",
              "A",
              "C",
              "x(1+3x)",
              "(3+x)(3-x)",
              "(x+3)(x-3)",
              "",
              "1;3",
              "(-1;-∞)",
              "C",
            ],
            id: "AKCP-10a17",
            timestamp: "2024-05-06T06:28:27.127Z",
          },
          "-NxBykcOoTp9wJly8uFF": {
            answers: [
              "0,73",
              "D",
              "0,3",
              "3,1",
              "BAC",
              "1",
              "C",
              "C",
              "",
              "",
              "",
              "",
              "",
              "",
              "B",
            ],
            id: "AKCP-10b10",
            timestamp: "2024-05-06T08:17:51.637Z",
          },
          "-NxByqtCQki6D1xehEQv": {
            answers: [
              "0,73",
              "B",
              "-1/3",
              "3/1",
              "ABC",
              "30",
              "A",
              "C",
              "",
              "",
              "",
              "",
              "",
              "",
              "D",
            ],
            id: "AKCP-10b1",
            timestamp: "2024-05-06T08:18:17.289Z",
          },
          "-NxBz652TSITRwVDpwX4": {
            answers: [
              "11/15",
              "B",
              "3/1",
              "3/1",
              "BCA",
              "5",
              "A",
              "D",
              "x+x(3+x)",
              "",
              "(x+3)(x-3)",
              "",
              "(1;-3)",
              "",
              "C",
            ],
            id: "AKCP-10b14",
            timestamp: "2024-05-06T08:19:23.647Z",
          },
          "-NxBzZnNBeeukcwy_puG": {
            answers: [
              "11/15",
              "b",
              "-1/3",
              "3/1",
              "bca",
              "30",
              "d",
              "D",
              "x+x(3+x)",
              "(x+2)x+1",
              "(x-3)(x+3)",
              "(x+2)x-3",
              "1;-3",
              "[-∞;-1]",
              "b",
            ],
            id: "AKCP-10b20",
            timestamp: "2024-05-06T08:21:25.326Z",
          },
          "-NxBzbP83HDCGh4bi3xW": {
            answers: [
              "4/6",
              "B",
              "1/2",
              "-1/3",
              "CBA",
              "5",
              "A",
              "D",
              "3 (x + x) + x ( x - x)",
              "x ( x + x) +1",
              "9 ( x - x)",
              "-3 ( x + x ) + x ( x + x)",
              "-",
              "-",
              "B",
            ],
            id: "AKCP-10b17",
            timestamp: "2024-05-06T08:21:36.004Z",
          },
          "-NxBzhtFBJp4vhO5iPfP": {
            answers: [
              "11/15",
              "B",
              "2",
              "2",
              "BCA",
              "30",
              "A",
              "D",
              "4",
              "4",
              "-8",
              "0",
              "1;3",
              "",
              "C",
            ],
            id: "AKCP-10b11",
            timestamp: "2024-05-06T08:22:02.566Z",
          },
          "-NxC-1sI6cNepGiOMT34": {
            answers: [
              "24/60",
              "B",
              "-1/3",
              "3/1",
              "CAB",
              "30",
              "A",
              "C",
              "x(x+3)",
              "(x+1)²",
              "x*x - 9",
              "",
              "1; -3",
              "",
              "C",
            ],
            id: "AKCP-10b2",
            timestamp: "2024-05-06T08:23:28.530Z",
          },
          "-NxC-E-YFCfl6_NUmOTs": {
            answers: [
              "0,7",
              "B",
              "-3",
              "3",
              "ACB",
              "13",
              "A",
              "C",
              "x(1+3x)",
              "x(x+2x+1)",
              "x(1+9x)",
              "",
              "-3;1",
              "(-begalybe; -1)",
              "B",
            ],
            id: "AKCP-10b7",
            timestamp: "2024-05-06T08:24:18.206Z",
          },
          "-NxC-Nl2ExE7SPHVPSJJ": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3/1",
              "CBA",
              "30",
              "A",
              "C",
              "x(1+3x)",
              "a=1  b=2  c=1",
              "(x-3)(x+3)",
              "a=1  b=2  c=-3",
              "1; -3",
              "[-∞;+∞]",
              "B",
            ],
            id: "AKCP-10b12",
            timestamp: "2024-05-06T08:24:58.176Z",
          },
          "-NxC-UpB88-mdPINLe6K": {
            answers: [
              "",
              "B",
              "",
              "√2 / (2+3) cm",
              " šaknis(2)/5 ",
              "saknis2 /5",
              "C",
              "A",
              "x∈(+∞;2]",
              "y∈(2x+1;x²]",
              "x² - 9 x² - 3² = (x + 3)(x-3)",
              "x ² + 2x - 3 = (x+ 3)(x -1)",
              " ",
              " ",
              "B",
            ],
            id: "AKCP-10b5",
            timestamp: "2024-05-06T08:25:27.111Z",
          },
          "-NxC-YxnKRo84lB3OElP": {
            answers: [
              "11/15 arba 0,73",
              "B",
              "-1/-3",
              "3/1",
              "BCA",
              "1",
              "A",
              "B",
              "x(1+3x)",
              "(x+1)2",
              "-9x2",
              "-1x3",
              "1;;2;4;6",
              "(+begalybe;2]",
              "C",
            ],
            id: "AKCP-10b6",
            timestamp: "2024-05-06T08:25:44.044Z",
          },
          "-NxC-hIh-fKOaCgSn6V_": {
            answers: [
              "11/15",
              "B",
              "3/1",
              "-1/3",
              "BCA",
              "30",
              "A",
              "A",
              "x(1+3x)",
              "x(x+2)+1",
              "(x+3)(x-3)",
              "x(x+2)-3",
              "9; -7",
              "(-∞; -1)",
              "D",
            ],
            id: "AKCP-10b16",
            timestamp: "2024-05-06T08:26:22.313Z",
          },
          "-NxC-o9kKMk3b_ap7udq": {
            answers: [
              "11/15 arba 0,73",
              "B",
              "",
              "3/1",
              "BCA",
              "1",
              "A",
              "C",
              "x(1+3x)",
              "(x+1)^2",
              "(x+3)(x-3)",
              "(x+3)(x-1)",
              "1",
              "",
              "C",
            ],
            id: "AKCP-10b18",
            timestamp: "2024-05-06T08:26:50.407Z",
          },
          "-NxC-oso4OU0gQr9KrID": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3",
              "BCA",
              "12,14",
              "A",
              "D",
              "9",
              "4",
              "-8",
              "0",
              "3;0",
              "2;+∞",
              "B",
            ],
            id: "AKCP-10b25",
            timestamp: "2024-05-06T08:26:53.358Z",
          },
          "-NxC-pd03DVJXkJH-vcg": {
            answers: [
              "0.73",
              "B",
              "-3",
              "3",
              "A; C; B",
              "1",
              "A",
              "D",
              "X(1+3X)",
              "X(1+2X+1)",
              "(1-9)",
              "X(1+2X-3)",
              "",
              "",
              "D",
            ],
            id: "AKCP-10b24",
            timestamp: "2024-05-06T08:26:56.444Z",
          },
          "-NxC-qBKrSZL4cLovfdc": {
            answers: [
              "0.48",
              "b",
              "-1/3",
              "2/3",
              "acb",
              "5",
              "a",
              "a",
              "x⋅(1+3x)",
              "(x+1)²",
              "(x-3)²",
              "(x-√3)²",
              "x=1",
              "",
              "",
            ],
            id: "AKCP-10b22",
            timestamp: "2024-05-06T08:26:58.704Z",
          },
          "-NxC-qxb-ISOZKt9fOXT": {
            answers: [
              "6,4",
              "B",
              "0/3",
              "2/3",
              "ABC",
              "20",
              "B",
              "C",
              "X+3x2",
              "x²+2+2+1",
              "x²-9x9",
              "x²",
              "x²+",
              "x²",
              "B",
            ],
            id: "AKCP-10b13",
            timestamp: "2024-05-06T08:27:01.858Z",
          },
          "-NxC-rV2VF8OdCYCTg6f": {
            answers: [
              "0,734",
              "B",
              "Prasau manes nenervinti",
              "3/1",
              "ACB",
              "30",
              "A",
              "D",
              "x⋅ ",
              "(x+1)² ",
              "(x-3) ⋅ (x+3)",
              "x⋅x+2⋅x-3",
              "x=-3; x=1. ",
              "(-∞:-1)      ",
              "B",
            ],
            id: "AKCP-10b8",
            timestamp: "2024-05-06T08:27:26.391Z",
          },
          "-NxC-rkwLkhkJ0-ArBJ-": {
            answers: [
              "11/15",
              "B",
              "3",
              "-3",
              "ACB",
              "2",
              "A",
              "D",
              "x(1+3x)",
              "(x+x)+(2+x)+1",
              "(x+x)-9",
              "(x+x)+(2+x)-3",
              "1;-3)",
              "",
              "B",
            ],
            id: "AKCP-10b19",
            timestamp: "2024-05-06T08:27:05.143Z",
          },
          "-NxC-tD6uyyBZIYJMcad": {
            answers: [
              "0.73",
              "B",
              "-3",
              "3",
              "ACB",
              "5",
              "A",
              "D",
              "x(1+3x)",
              "",
              "x²-3²",
              "",
              "-3;1",
              "[4;-∞))",
              "A",
            ],
            id: "AKCP-10b9",
            timestamp: "2024-05-06T08:27:11.106Z",
          },
          "-NxC-u5WAYjSoiqoVgop": {
            answers: [
              "11/15",
              "B",
              "3",
              "3",
              "BCA",
              "30",
              "A",
              "D",
              "x(3+x)",
              "x(",
              "",
              "",
              "1;-3",
              "(-oo; 0]",
              "D",
            ],
            id: "AKCP-10b21",
            timestamp: "2024-05-06T08:27:14.711Z",
          },
          "-NxC02neQCOAzkToTEaM": {
            answers: [
              "11/15",
              "B",
              "-1/3",
              "3/1",
              "CAB",
              "5",
              "A",
              "D",
              "x(3x+x)=0",
              "",
              "x-3",
              "",
              "",
              "-1",
              "B",
            ],
            id: "AKCP-10b26",
            timestamp: "2024-05-06T08:27:54.469Z",
          },
          "-NxC02txekrv7s5sgaFV": {
            answers: [
              "5/ 6-1/ 6*0,6=0,55",
              "B",
              "-1/3",
              "3",
              "11,5√5,3√13",
              "5",
              "C",
              "C",
              "X+6X",
              "4X+1",
              "9X²",
              "X²",
              "X²",
              "10",
              "B",
            ],
            id: "AKCP-10b23",
            timestamp: "2024-05-06T08:27:54.874Z",
          },
          "-NxC03Sv7A0qLClSKRSa": {
            answers: [
              "0,42",
              "B",
              "",
              "",
              "CAB",
              "5",
              "A",
              "C",
              "x+3*x*x",
              "",
              "",
              "",
              "",
              "",
              "B",
            ],
            id: "AKCP-10b3",
            timestamp: "2024-05-06T08:27:57.174Z",
          },
        };
        const answerKey = [
          {
            number: "1.",
            correctAnswers: ["11/15", "0,7(3)", "0.7(3)"],
          },
          {
            number: "2.",
            correctAnswers: ["B"],
          },
          {
            number: "3.",
            correctAnswers: ["-1/3", "-0.(3)", "-0,(3)"],
          },
          {
            number: "4.",
            correctAnswers: ["3"],
          },
          {
            number: "5.",
            correctAnswers: ["BCA"],
          },
          {
            number: "6.",
            correctAnswers: ["30"],
          },
          {
            number: "7.",
            correctAnswers: ["A"],
          },
          {
            number: "8.",
            correctAnswers: ["D"],
          },
          {
            number: "9.",
            correctAnswers: ["x(1+3x)", "x(3x+1)", "(1+3x)x", "(3x+1)x"],
          },
          {
            number: "10.",
            correctAnswers: ["(x+1)²", "(1+x)²"],
          },
          {
            number: "11.",
            correctAnswers: [
              "(x-3)(x+3)",
              "(x-3)(3+x)",
              "(x+3)(x-3)",
              "(3+x)(x-3)",
            ],
          },
          {
            number: "12.",
            correctAnswers: [
              "(x-1)(x+3)",
              "(x+3)(x-1)",
              "(x-1)(3+x)",
              "(3+x)(x-1)",
            ],
          },
          {
            number: "13.",
            correctAnswers: ["1;-3", "-3;1"],
          },
          {
            number: "14.",
            correctAnswers: ["(-∞;-1)"],
          },
          {
            number: "15.",
            correctAnswers: ["B"],
          },
        ];
        let results = [];
        // [
        //   {
        //     grade: 0,
        //     id: "1",
        //     outOf: 0,
        //     points: 0,
        //     responses: [
        //       {
        //         answer: "Atsakymas1",
        //         correct: true,
        //         correctAnswer: "Atsakymas1",
        //         question: "1.",
        //       },
        //       {
        //         answer: "Atsakymas2",
        //         correct: false,
        //         correctAnswer: "Atsakymas3",
        //         question: "2.",
        //       },
        //     ],
        //   },
        // ];

        //algo
        Object.keys(responsesFinal).forEach((responseId) => {
          const response = responsesFinal[responseId];
          let gradedResults = {
            id: response.id,
            responses: [],
            points: 0,
            outOf: answerKey.length,
            grade: 0,
          };

          response.answers.forEach((answer, index) => {
            const questionNumber = index + 1;
            const questionKey = answerKey.find(
              (q) => q.number === questionNumber + "."
            );
            const isCorrect = questionKey
              ? questionKey.correctAnswers.includes(answer.replace(/\s/g, ""))
              : false;
            gradedResults.responses.push({
              question: questionNumber + ".",
              answer: answer,
              correct: isCorrect,
              correctAnswer: questionKey
                ? questionKey.correctAnswers.join(" or ")
                : "No answer provided",
            });
            if (isCorrect) {
              gradedResults.points++;
            }
          });

          gradedResults.grade =
            (gradedResults.points * 8) / gradedResults.outOf + 2;
          results.push(gradedResults);
        });

        //push
        const resultsRef = ref(database, "results");
        set(resultsRef, results);
        alert("graded");
      }
      // Function to load and display data from Firebase in real time
      function loadData() {
        const dbRef = ref(database, "responses"); // Adjust 'responses' to your specific data path in Firebase
        const fullscreenRef = ref(database, "fullscreenLogs");
        const feedbackRef = ref(database, "feedback");
        onValue(fullscreenRef, (snapshot) => {
          const data = snapshot.val();
          const table = document.getElementById("fullscreenTable");
          // Clear previous contents
          table.innerHTML = "";

          // Create table headers
          const header = table.createTHead();
          const headerRow = header.insertRow(0);
          headerRow.insertCell(0).textContent = "ID";
          headerRow.insertCell(1).textContent = "Timestamp";

          // Insert data into the table
          if (!data) return; // Exit if there is no data (null or undefined
          Object.keys(data).forEach((key, index) => {
            const row = table.insertRow(-1);
            row.insertCell(0).textContent = data[key].id;
            row.insertCell(1).textContent = new Date(
              data[key].timestamp
            ).toLocaleString("lt-LT");
          });
        });
        onValue(dbRef, (snapshot) => {
          const data = snapshot.val();
          const table = document.getElementById("dataTable");
          // Clear previous contents
          table.innerHTML = "";

          // Create table headers
          const header = table.createTHead();
          const headerRow = header.insertRow(0);
          headerRow.insertCell(0).textContent = "ID";
          headerRow.insertCell(1).textContent = "Answers";
          headerRow.insertCell(2).textContent = "Timestamp";
          if (!data) return; // Exit if there is no data (null or undefined

          // Insert data into the table
          Object.keys(data).forEach((key, index) => {
            const row = table.insertRow(-1);
            row.insertCell(0).textContent = data[key].id;
            row.insertCell(1).textContent = data[key].answers?.join(", ");
            row.insertCell(2).textContent = new Date(
              data[key].timestamp
            ).toLocaleString("lt-LT");
          });
        });
        onValue(feedbackRef, (snapshot) => {
          const data = snapshot.val();
          const table = document.getElementById("feedbackTable");
          // Clear previous contents
          table.innerHTML = "";

          // Create table headers
          const header = table.createTHead();
          const headerRow = header.insertRow(0);
          headerRow.insertCell(0).textContent = "ID";
          headerRow.insertCell(1).textContent = "Feedback";
          headerRow.insertCell(2).textContent = "Timestamp";

          if (!data) return; // Exit if there is no data (null or undefined

          // Insert data into the table
          Object.keys(data).forEach((key, index) => {
            const row = table.insertRow(-1);
            row.insertCell(0).textContent = data[key].id;
            row.insertCell(1).textContent = data[key].feedback;
            row.insertCell(2).textContent = new Date(
              data[key].timestamp
            ).toLocaleString("lt-LT");
          });
        });
      }
      document.addEventListener("DOMContentLoaded", () => {
        const downloadButton = document.getElementById("downloadBtn");
        downloadButton.addEventListener("click", async () => {
          const dbRef = ref(database);
          try {
            const snapshot = await get(dbRef);
            if (snapshot.exists()) {
              const data = snapshot.val();
              downloadJSON(data, "firebase-data.json");
            } else {
              console.log("No data available");
            }
          } catch (error) {
            console.error("Failed to fetch data:", error);
          }
        });

        // Function to download data as JSON file
        function downloadJSON(data, filename) {
          const blob = new Blob([JSON.stringify(data, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.setAttribute("href", url);
          a.setAttribute("download", filename);
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }
      });

      window.addEventListener("DOMContentLoaded", loadData); // Load data when the document is ready
    </script>
  </head>
  <body>
    <button id="gradeResponses">GRADE NOW AUTO</button>
    <button id="gradeResponses2">GRADE NOW AUTO 2</button>
    <h1>Nelegalūs išėjimai iš viso ekrano rėžimo</h1>
    <table id="fullscreenTable">
      <caption>
        Išėjimų iš viso ekrano rėžimo duomenys:
      </caption>
    </table>
    <h1>Pateikti atsakymai</h1>
    <table id="dataTable">
      <caption>
        Atsakymų duomenys:
      </caption>
    </table>

    <h1>Grįžtamasis ryšys</h1>
    <table id="feedbackTable">
      <caption>
        Grįžtamojo ryšio duomenys:
      </caption>
    </table>
    <button id="downloadBtn">Atsisiųsti visą informaciją JSON formatu</button>
  </body>
</html>
